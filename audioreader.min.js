/*
	AudioReader version 0.6.1 BETA
	(c) 2015-2016 epistemex.com
	MIT License (this header required)
*/
function AudioReader(j,b){var a=(window.AudioContext||window.webkitAudioContext);if(!a||!window.Promise){throw"Outdated browser"}return new Promise(function(p,o){typeof j==="string"?k(j).then(n,o):n(j);function n(q){var v=new DataView(q),u=f(v),t=["aiff","iff","au"];b=b||new a();if(t.indexOf(u)<0){try{b.decodeAudioData(q.slice(0),function(w){var y=w.length,x=w.numberOfChannels,A=w.duration,z=w.sampleRate;p({audioContext:b,buffer:w,createPlayObject:m,channels:x,rate:z,time:A,bits:((A*x*z)/y)<<3,frames:y,type:u||"browser",compression:"",internal:!0})},r)}catch(s){o(s.message)}}else{r()}function r(){var w,x,y;if(u==="au"){y=c(v,u);if(y.type){w=[{fourcc:4278190097,size:12,offset:12},{fourcc:4278190098,size:y.size-y.offset,offset:y.offset}];x=l(b,v,y,w);x.buffer?p(x):o(x.error)}}else{y=d(v,u,!0);if(y.type){w=g(v,y.lsb,(y.type==="caff"));if(w.length<2){o("Invalid file")}x=l(b,v,y,w);x.buffer?p(x):o(x.error)}}o(y.error)}}});function d(p,n,o){return o?{type:n,size:-1,lsb:(n==="wave")}:h(p,n,4,8,(n==="wave"),p.buffer.byteLength)}function c(q,n){var o=q.getUint32(4),p=h(q,n,8,o,!1,q.buffer.byteLength);p.offset=o;return p}function h(s,o,q,n,p,t){var r=s.getUint32(q,p)+n;if(r===4294967295){r=s.buffer.byteLength-q}if(r!==t){return{error:"Invalid size"}}return{type:o,size:r,lsb:p}}function g(x,s,p){var v=p?8:12,t=10,r=x.buffer.byteLength,n=[],q,w,u;try{while(v<r&&t--){q=x.getUint32(v);w=p?x.getUint32(v+8,s):x.getUint32(v+4,s);u=(p?12:8);n.push({fourcc:q,size:w,offset:v+u});v+=w+u}}catch(o){console.log(o)}return n}function l(o,P,O,C){var K,B,L,E,n,A,M,p,I,J,G,H,N,D=null,x=1718449184,v=1129270605,w=1684108385,y=1397968452,z=1447576658,u=1128808782,s=1112491097,r=4278190097,q=4278190098,t=1684370275,F="Unsupported format";for(K=0;B=C[K++];){L=B.offset;E=B.size;if(B.fourcc===x){H=[-2,1,17];G=P.getInt16(L,!0);if(H.indexOf(G)<0){return{error:F}}else{if(G===17){D="adpcm"}}p=P.getUint16(L+14,!0);A=P.getUint16(L+2,!0);M=P.getUint32(L+4,!0)}else{if(B.fourcc===v){A=P.getInt16(L);J=P.getInt32(L+2);p=P.getInt16(L+6);M=i(new Uint8Array(P.buffer,L+8,10))}else{if(B.fourcc===z){if(P.getUint8(L+15)!==0){return{error:F}}J=P.getUint32(L);M=P.getUint16(L+12);A=1;p=8}else{if(B.fourcc===u){A=P.getUint8(L)===6?2:1}else{if(B.fourcc===r){G=P.getUint32(L);if((G<1||G>5)&&G!==27){return{error:F}}if(G===1){D="ulaw";p=8}else{if(G===27){D="alaw";p=8}else{p=(G-1)*8}}M=P.getUint32(L+4);A=P.getUint32(L+8)}else{if(B.fourcc===t){M=P.getFloat64(L);H=[1819304813,1970037111,1634492791];G=P.getUint32(L+8);if(H.indexOf(G)<0){return{error:"Error compression"}}if(G===1970037111){D="ulaw"}else{if(G===1634492791){D="alaw"}}A=P.getUint32(L+24);p=P.getUint32(L+28)}}}}}}}I=(M*A*p)>>>3;if(!J){J=Math.ceil(E/I)*M}for(K=0;B=C[K++];){L=B.offset;E=B.size;if(B.fourcc===w){if(D==="adpcm"){J=B.size*8/A}n=e(o,P,E,L,A,M,p,J,!0,D)}else{if(B.fourcc===y){E-=8;L+=8;n=e(o,P,E,L,A,M,p,J,!1)}else{if(B.fourcc===s){n=e(o,P,E,L,A,M,p,J,!1)}else{if(B.fourcc===q){n=e(o,P,E,L,A,M,p,J,!1,D)}}}}}N=I?E/I:0;return n?{audioContext:o,buffer:n,type:O.type,channels:A,rate:M,bits:p,time:N,frames:J,compression:D?D:"",createPlayObject:m}:{error:"Error creating audio buffer"}}function e(o,X,Q,S,u,U,q,C,R,x){try{var n=o.createBuffer(u,C,U),T,V,O,P,r=X.buffer.byteLength-S,v=[],A=q/8,z=new Uint8Array([0,1,2,3,3,2,1,0]),y=AudioReader.dither,s=[y?K:J,E,G,H,y?L:J,F,G,I],w,D;if(x){if(x==="ulaw"){D=N}else{if(x==="alaw"){D=M}}}else{w=((q/8)-1)+(R?0:4);D=s[w]}for(O=0;O<u;O++){v.push(n.getChannelData(O))}T=S;O=V=0;if(Q>r){Q=r}if(x==="adpcm"){console.log("ADPCM 4-bit N/A")}else{while(O<Q){for(P=0;P<u;){v[P++][V]=D(T+O);O+=A}V++}}return n}catch(B){console.log(B);return null}function J(t){return X.getInt8(t)/128}function E(t){return X.getInt16(t,!0)/32768}function F(t){return X.getInt16(t)/32768}function G(t){return((X.getInt32(t,!0)&16777215)<<8)/8388607}function H(t){return X.getInt32(t,!0)/2147483648}function I(t){return X.getInt32(t)/2147483648}function K(Y){var t=X.getInt8(Y,!0)<<8;t=t&~z[t%8];return t/32768}function L(Y){var t=X.getInt8(Y)<<8;t=t&~z[t%8];return t/32768}function N(t){return W(X.getUint8(t))}function M(t){return p(X.getUint8(t))}function W(Y){Y=~Y;var t=((Y&15)<<3)+132;t<<=(Y&112)>>4;Y=Y&128?132-t:t-132;return Y/32768}function p(Y){var aa;var Z;Y^=85;aa=(Y&15)<<4;Z=(Y&112)>>4;if(Z===0){aa+=8}else{if(Z===1){aa+=264}else{aa+=264;aa<<=Z-1}}aa=(Y&128)?aa:-aa;return aa/32768}}function m(){var n=this.audioContext.createBufferSource();n.buffer=this.buffer;n.connect(this.audioContext.destination);if(!n.start){n.start=n.noteOn}return n}function i(o){var s=(o[0]&128),p=(((o[0]&127)<<8)|o[1])-16383,t=0,q=2,n,r=o.length;for(;q<r;q++){for(n=7;n>=0;n--){if(o[q]&(1<<n)){t+=p<0?1/(Math.pow(2,-p)):Math.pow(2,p)}p--}}return s?t*-1:t}function k(n){return new Promise(function(q,p){try{var r=new XMLHttpRequest();r.open("GET",n);r.responseType="arraybuffer";r.onerror=function(){p("Network error.")};r.onload=function(){if(r.status===200){q(r.response)}else{p("Loading error:"+r.statusText)}};r.send()}catch(o){p(o.message)}})}function f(p){if(p.buffer.byteLength<64){return null}var n=p.getUint32(0),o=p.getUint32(8);switch(n){case 1179603533:if(o===1095321158){return"aiff"}if(o===944985688){return"iff"}break;case 1380533830:if(o===1463899717){return"wave"}break;case 1332176723:return"ogg";case 1716281667:return"flac";case 779316836:return"au";case 1667327590:return"caff"}if(n>>>8===4801587){return"mp3"}return null}}AudioReader.dither=!0;AudioReader.render=function(q){var s=q.data,a=s.buffer,d=Math.min(q.maxChannels||99,s.channels),r=q.quality||2,p=q.opacity||1/(d*r),B=q.width||640,f=q.height||64,g=f>>1,m=a.getChannelData(0).length,u=Math.max(1,m/B),y=u/r,c,l=0,z=0,j,C,A,o=0,n=q.mode||"bars",b=document.createElement("canvas"),e=b.getContext("2d");b.width=B;b.height=f;if(q.bgColor){e.fillStyle=q.bgColor;e.fillRect(0,0,B,f)}e.fillStyle=q.color||"#000";e.globalAlpha=p;e.translate(0,g);if(n==="mirror"){while(l++<r){z=0;while(z<d){c=a.getChannelData(z++);e.beginPath();e.moveTo(0,0);for(j=o,C=0;j<m;j+=u){A=Math.abs((c[j|0]*g)|0);e.lineTo(C++,-A)}e.lineTo(B,0);e.fill();e.scale(1,-1);e.drawImage(b,0,-g);e.scale(1,-1)}o+=y}}else{while(l++<r){z=0;while(z<d){c=a.getChannelData(z++);e.beginPath();for(j=o,C=0;j<m;j+=u){A=Math.abs((c[j|0]*g)|0);e.rect(C++,-A,1,A<<1)}e.fill()}o+=y}}e.beginPath();e.strokeStyle=e.fillStyle;e.globalAlpha=1;e.moveTo(0,0.5);e.lineTo(B,0.5);e.stroke();return b};